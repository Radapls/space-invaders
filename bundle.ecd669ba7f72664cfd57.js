(()=>{"use strict";class t{constructor(){this.pressed=new Set,window.addEventListener("keydown",t=>this.pressed.add(t.code)),window.addEventListener("keyup",t=>this.pressed.delete(t.code))}isPressed(t){return this.pressed.has(t)}}const e={WIDTH:20,HEIGHT:20,COLORS:["#39d353","#26a641","#006d32","#0e4429"]},s="radapls";class i{constructor(t){this.ctx=t}drawShip(t){this.ctx.drawImage(t.image,t.x,t.y,t.width,t.height)}drawBullet(t){t.destroyed||(this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),this.ctx.fillStyle="blue",this.ctx.fill(),this.ctx.closePath())}drawTargets(t){t.forEach(t=>{t.destroyed||(this.ctx.fillStyle=e.COLORS[Math.floor(Math.random()*e.COLORS.length)],this.ctx.fillRect(t.x,t.y,t.width,t.height))})}drawScore(t){const e=this.ctx,{width:s}=e.canvas;this.ctx.font="bold 20px Courier New",this.ctx.fillStyle="white",this.ctx.fillText(`Score: ${t}`,s/2,30)}drawEndGame(){const t=this.ctx,{width:e,height:s}=t.canvas;t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(0,0,e,s),t.font='bold 48px "Courier New", monospace',t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.fillText("Game Over",e/2,s/2),t.font='20px "Courier New", monospace'}clear(){this.ctx.clearRect(0,0,800,600)}drawRestartInstruction(){const t=this.ctx,{width:e,height:s}=t.canvas;t.font='bold 24px "Courier New", monospace',t.fillStyle="yellow",t.textAlign="center",t.textBaseline="bottom",t.fillText("Haz clic en el botÃ³n Reset para volver a jugar",e/2,.75*s)}}const h=t=>{const e=new Image;return e.src="https://cdn-icons-png.flaticon.com/512/1985/1985828.png",{x:t.width/2,y:t.height-40-10,width:40,height:40,speed:5,image:e,destroyed:!1}},r=t=>({x:t.x+t.width/2,y:t.y,radius:5,speed:10,width:2,height:2,destroyed:!0}),a=document.getElementById("canvas");if(!a)throw new Error("Canvas no encontrado");const d=new class{constructor(e){this.canvas=e,this.targets=[],this.score=0,this.input=new t,this.loop=()=>{this.update(),this.render(),requestAnimationFrame(this.loop)},this.canvas.width=800,this.canvas.height=600,this.renderer=new i(e.getContext("2d")),this.ship=h(e),this.bullet=r(this.ship)}async init(){const t=await(async()=>{const t=`https://api.github.com/repos/${s}/${s}.github.io/commits`,e=await fetch(t,{cache:"no-store"});if(!e.ok)throw new Error(`GitHub API error: ${e.status}`);return e.json()})();this.targets=t.map(()=>(t=>({x:Math.random()*t.width,y:Math.random()*t.height/2,width:e.WIDTH,height:e.HEIGHT,destroyed:!1}))(this.canvas))}start(){requestAnimationFrame(()=>this.loop())}update(){this.handleInput(),this.moveTargets(),this.moveBullet(),this.detectCollisions()}handleInput(){this.input.isPressed("ArrowLeft")&&(this.ship.x-=5),this.input.isPressed("ArrowRight")&&(this.ship.x+=5),this.input.isPressed("ArrowUp")&&(this.ship.y-=5),this.input.isPressed("ArrowDown")&&(this.ship.y+=5),this.ship.x=Math.min(Math.max(this.ship.x,0),this.canvas.width-40),this.ship.y=Math.min(Math.max(this.ship.y,0),this.canvas.height-40),this.input.isPressed("Space")&&this.bullet.destroyed&&(this.bullet.destroyed=!1,this.bullet.x=this.ship.x+this.ship.width/2,this.bullet.y=this.ship.y)}moveTargets(){this.targets.forEach(t=>{t.destroyed||(t.y+=1,t.y>this.canvas.height&&(t.y=0,t.x=Math.random()*this.canvas.width))})}moveBullet(){this.bullet.destroyed||(this.bullet.y-=this.bullet.speed,this.bullet.y<0&&(this.bullet.destroyed=!0),this.targets.forEach(t=>{t.destroyed||this.bullet.x>t.x&&this.bullet.x<t.x+t.width&&this.bullet.y>t.y&&this.bullet.y<t.y+t.height&&(t.destroyed=!0,this.bullet.destroyed=!0,this.score++)}))}detectCollisions(){this.targets.forEach(t=>{t.destroyed||this.ship.x<t.x+t.width&&this.ship.x+40>t.x&&this.ship.y<t.y+t.height&&this.ship.y+40>t.y&&(t.destroyed=!0,this.score++)})}render(){this.targets.every(t=>t.destroyed)?this.endGame():(this.renderer.clear(),this.renderer.drawShip(this.ship),this.renderer.drawBullet(this.bullet),this.renderer.drawTargets(this.targets),this.renderer.drawScore(this.score))}async reset(){await this.init(),this.ship=h(this.canvas),this.bullet=r(this.ship),this.score=0,this.targets.forEach(t=>{t.destroyed=!1,t.x=Math.random()*this.canvas.width,t.y=Math.random()*this.canvas.height/2}),this.start()}endGame(){this.renderer.clear(),this.renderer.drawEndGame(),this.renderer.drawRestartInstruction()}}(a),n=document.getElementById("reset-button");(async()=>{await d.init(),d.start()})(),n.addEventListener("click",()=>d.reset())})();